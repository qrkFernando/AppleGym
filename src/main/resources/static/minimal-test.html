<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Test AppleGym</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { border-color: #28a745; background-color: #d4edda; }
        .error { border-color: #dc3545; background-color: #f8d7da; }
        .warning { border-color: #ffc107; background-color: #fff3cd; }
        .btn {
            background: #42944C;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background: #357a3f;
        }
        #console {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagn√≥stico Minimal AppleGym</h1>
        <p>Esta p√°gina ayudar√° a identificar exactamente qu√© est√° causando el problema.</p>

        <div class="test-section" id="basic-test">
            <h3>üß™ Test 1: JavaScript B√°sico</h3>
            <button class="btn" onclick="runBasicTest()">Ejecutar Test B√°sico</button>
            <div id="basic-results"></div>
        </div>

        <div class="test-section" id="dom-test">
            <h3>üéØ Test 2: Manipulaci√≥n DOM</h3>
            <button class="btn" onclick="runDOMTest()">Ejecutar Test DOM</button>
            <div id="dom-results"></div>
        </div>

        <div class="test-section" id="api-test">
            <h3>üåê Test 3: Conexi√≥n API</h3>
            <button class="btn" onclick="runAPITest()">Ejecutar Test API</button>
            <div id="api-results"></div>
        </div>

        <div class="test-section" id="script-test">
            <h3>üìÑ Test 4: Carga de Scripts</h3>
            <button class="btn" onclick="runScriptTest()">Ejecutar Test Scripts</button>
            <div id="script-results"></div>
        </div>

        <div class="test-section" id="main-app-test">
            <h3>üöÄ Test 5: App.js Principal</h3>
            <button class="btn" onclick="runMainAppTest()">Cargar App.js y Testar</button>
            <div id="main-app-results"></div>
        </div>

        <div class="test-section">
            <h3>üì± Console Log</h3>
            <div id="console"></div>
            <button class="btn" onclick="clearConsole()">Limpiar Console</button>
        </div>

        <div class="test-section">
            <h3>üîó Enlaces Directos</h3>
            <a href="/" class="btn" style="text-decoration: none; display: inline-block;">üè† Ir a Index Principal</a>
            <a href="/test-simple.html" class="btn" style="text-decoration: none; display: inline-block;">üß™ Test Simple</a>
            <a href="/debug.html" class="btn" style="text-decoration: none; display: inline-block;">üîß Debug Completo</a>
        </div>
    </div>

    <script>
        // Console override para capturar logs
        const consoleDiv = document.getElementById('console');
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6666' : type === 'warn' ? '#ffaa00' : '#00ff00';
            consoleDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${type.toUpperCase()}: ${message}</span>\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalConsole.log.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalConsole.error.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalConsole.warn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };

        function clearConsole() {
            consoleDiv.innerHTML = '';
        }

        function setResult(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div style="margin-top: 10px; padding: 10px; border-radius: 4px; background-color: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#fff3cd'};">${message}</div>`;
        }

        function runBasicTest() {
            console.log('üß™ Iniciando test b√°sico...');
            
            try {
                // Test 1: Arrays y funciones
                const numbers = [1, 2, 3, 4, 5];
                const doubled = numbers.map(n => n * 2);
                console.log('Array test:', doubled);

                // Test 2: Objetos
                const testObj = { name: 'AppleGym', version: '1.0' };
                console.log('Object test:', testObj);

                // Test 3: Promises
                const testPromise = new Promise(resolve => {
                    setTimeout(() => resolve('Promise resolved'), 100);
                });
                console.log('Promise created');

                // Test 4: Arrow functions
                const arrowFunc = (x) => x + 1;
                console.log('Arrow function test:', arrowFunc(5));

                setResult('basic-results', '‚úÖ JavaScript b√°sico funciona correctamente', 'success');
                
            } catch (error) {
                console.error('Error in basic test:', error);
                setResult('basic-results', '‚ùå Error: ' + error.message, 'error');
            }
        }

        function runDOMTest() {
            console.log('üéØ Iniciando test DOM...');
            
            try {
                // Test 1: getElementById
                const testElement = document.getElementById('dom-results');
                if (!testElement) throw new Error('No se puede encontrar elemento por ID');
                console.log('getElementById: OK');

                // Test 2: querySelector
                const testQuery = document.querySelector('.container');
                if (!testQuery) throw new Error('querySelector no funciona');
                console.log('querySelector: OK');

                // Test 3: createElement
                const newDiv = document.createElement('div');
                newDiv.innerHTML = 'Elemento creado din√°micamente';
                newDiv.style.color = '#42944C';
                console.log('createElement: OK');

                // Test 4: Event listeners
                const testBtn = document.createElement('button');
                testBtn.textContent = 'Test Button';
                testBtn.onclick = () => console.log('Click event works!');
                console.log('Event listeners: OK');

                setResult('dom-results', '‚úÖ Manipulaci√≥n DOM funciona correctamente', 'success');
                
            } catch (error) {
                console.error('Error in DOM test:', error);
                setResult('dom-results', '‚ùå Error: ' + error.message, 'error');
            }
        }

        async function runAPITest() {
            console.log('üåê Iniciando test API...');
            
            try {
                // Test connection
                console.log('Conectando a /api/test-full/hello...');
                
                const response = await fetch('/api/test-full/hello', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('API Response data:', data);

                setResult('api-results', `‚úÖ API funciona: ${data.message} (${data.timestamp})`, 'success');
                
            } catch (error) {
                console.error('Error in API test:', error);
                setResult('api-results', '‚ùå Error API: ' + error.message, 'error');
            }
        }

        function runScriptTest() {
            console.log('üìÑ Iniciando test de scripts...');
            
            try {
                // Check if scripts are loading
                const scripts = document.querySelectorAll('script');
                console.log(`Found ${scripts.length} scripts in page`);

                scripts.forEach((script, index) => {
                    console.log(`Script ${index + 1}: ${script.src || 'inline'}`);
                });

                // Test script loading
                const testScript = document.createElement('script');
                testScript.type = 'text/javascript';
                testScript.text = 'console.log("Dynamic script loaded successfully");';
                document.head.appendChild(testScript);
                
                setResult('script-results', '‚úÖ Scripts se cargan correctamente', 'success');
                
            } catch (error) {
                console.error('Error in script test:', error);
                setResult('script-results', '‚ùå Error: ' + error.message, 'error');
            }
        }

        function runMainAppTest() {
            console.log('üöÄ Cargando app.js principal...');
            
            try {
                // First check if it's already loaded
                if (typeof window.AppleGym !== 'undefined') {
                    console.log('App.js ya est√° cargado');
                    setResult('main-app-results', '‚úÖ App.js ya estaba cargado y disponible', 'success');
                    return;
                }

                // Try to load the main app.js
                const script = document.createElement('script');
                script.src = '/js/app.js';
                script.type = 'text/javascript';
                
                script.onload = function() {
                    console.log('app.js cargado exitosamente');
                    
                    // Wait a bit and check if AppleGym is available
                    setTimeout(() => {
                        if (typeof window.AppleGym !== 'undefined') {
                            console.log('AppleGym object disponible');
                            setResult('main-app-results', '‚úÖ App.js cargado y AppleGym disponible', 'success');
                        } else {
                            console.warn('app.js cargado pero AppleGym no disponible');
                            setResult('main-app-results', '‚ö†Ô∏è App.js cargado pero objeto AppleGym no encontrado', 'warning');
                        }
                    }, 1000);
                };
                
                script.onerror = function() {
                    console.error('Error cargando app.js');
                    setResult('main-app-results', '‚ùå Error cargando app.js', 'error');
                };
                
                document.head.appendChild(script);
                console.log('Script app.js agregado al DOM');
                
            } catch (error) {
                console.error('Error in main app test:', error);
                setResult('main-app-results', '‚ùå Error: ' + error.message, 'error');
            }
        }

        // Auto-run basic tests on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Minimal test page loaded');
            console.log('User Agent:', navigator.userAgent);
            console.log('URL:', window.location.href);
            console.log('Protocol:', window.location.protocol);
            
            // Auto-run basic test
            setTimeout(() => {
                console.log('Auto-running basic test...');
                runBasicTest();
            }, 500);
        });

        console.log('üìã Minimal test scripts loaded');
    </script>
</body>
</html>